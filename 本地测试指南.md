# ğŸš€ æœ¬åœ°æµ‹è¯•æŒ‡å—

æœ¬æŒ‡å—å°†å¸®åŠ©æ‚¨åœ¨æœ¬åœ°ç¯å¢ƒä¸­è¿è¡Œå’Œæµ‹è¯•ç»˜æœ¬ç”Ÿæˆå™¨ï¼ˆé»˜è®¤ **Gemini**ï¼Œä¹Ÿæ”¯æŒåˆ‡æ¢åˆ° **Azure OpenAI**ï¼‰ã€‚

## ğŸ“‹ å‰ç½®è¦æ±‚

1. **Python 3.10 æˆ–æ›´é«˜ç‰ˆæœ¬**
   ```bash
   python3 --version
   # åº”è¯¥æ˜¾ç¤º Python 3.10.x æˆ–æ›´é«˜
   ```

2. **ï¼ˆé»˜è®¤ï¼‰Google Gemini API å¯†é’¥**
   - è®¿é—® https://aistudio.google.com/app/apikey
   - åˆ›å»ºæˆ–è·å–æ‚¨çš„ API å¯†é’¥
   - ä¿å­˜å¥½å¯†é’¥ï¼Œç¨åéœ€è¦ç”¨åˆ°

3. **ï¼ˆå¯é€‰ï¼‰Azure OpenAI é…ç½®ï¼ˆå¦‚æœä½ æƒ³ç”¨ Azure OpenAI æ›¿ä»£ Geminiï¼‰**
   - ä½ éœ€è¦ï¼š`AZURE_OPENAI_ENDPOINT`ã€`AZURE_OPENAI_API_KEY`ã€`AZURE_OPENAI_API_VERSION`
   - ä»¥åŠä¸€ä¸ª **Chat éƒ¨ç½²å**ï¼ˆdeployment nameï¼Œæ¯”å¦‚ä½ éƒ¨ç½²çš„ gpt-4o å« `gpt-4o`ï¼‰
   - å¯é€‰ï¼šå¦‚æœè¦ç”Ÿæˆâ€œçœŸå®å›¾ç‰‡â€ï¼Œè¿˜éœ€è¦ä¸€ä¸ª **Images/DALLÂ·E éƒ¨ç½²å**ï¼ˆæ²¡æœ‰çš„è¯ç¨‹åºä¼šç”¨å ä½å›¾ï¼‰

> è¯´æ˜ï¼šAzure OpenAI é‡Œä»£ç é‡Œä¼ çš„ `model=...` ä¸€èˆ¬æ˜¯ **deployment name**ï¼Œä¸æ˜¯çœŸæ­£çš„æ¨¡å‹å­—ç¬¦ä¸²ã€‚
> ä½ æåˆ°çš„ `gpt-4o (2024-08-06)` æ˜¯æ¨¡å‹ç‰ˆæœ¬ä¿¡æ¯ï¼Œå®é™…ç”± Azure éƒ¨ç½²å†³å®šï¼Œä»£ç ä¾§åªéœ€è¦å¡« deployment nameã€‚

## ğŸ”§ æ–¹æ³•ä¸€ï¼šä½¿ç”¨ uvï¼ˆæ¨èï¼‰

### æ­¥éª¤ 1: å®‰è£… uvï¼ˆå¦‚æœè¿˜æ²¡æœ‰ï¼‰

```bash
# macOS/Linux
curl -LsSf https://astral.sh/uv/install.sh | sh

# æˆ–è€…ä½¿ç”¨ pip
pip install uv
```

### æ­¥éª¤ 2: å®‰è£…é¡¹ç›®ä¾èµ–

```bash
cd /Users/laisingkuang/Downloads/gemini_picturebook_generator
uv sync
```

### æ­¥éª¤ 3: é…ç½® API å¯†é’¥

```bash
# å¤åˆ¶ç¯å¢ƒå˜é‡æ¨¡æ¿
cp .env.template .env

# ç¼–è¾‘ .env æ–‡ä»¶ï¼Œæ·»åŠ æ‚¨çš„ API å¯†é’¥
# ä½¿ç”¨æ‚¨å–œæ¬¢çš„ç¼–è¾‘å™¨ï¼Œä¾‹å¦‚ï¼š
nano .env
# æˆ–
vim .env
# æˆ–ä½¿ç”¨ VS Code
code .env
```

åœ¨ `.env` æ–‡ä»¶ä¸­ï¼Œå°† `your_google_api_key_here` æ›¿æ¢ä¸ºæ‚¨çš„å®é™… API å¯†é’¥ï¼š
```
GOOGLE_API_KEY=æ‚¨çš„å®é™…APIå¯†é’¥
```

#### âœ… å¦‚æœä½ æƒ³æ”¹ç”¨ Azure OpenAIï¼ˆæ›¿ä»£ Geminiï¼‰
åœ¨åŒä¸€ä¸ª `.env` é‡Œæ·»åŠ ï¼ˆç¤ºä¾‹ï¼‰ï¼š

```
# åˆ‡æ¢ provider
AI_PROVIDER=azure

# Azure OpenAI åŸºæœ¬é…ç½®
AZURE_OPENAI_ENDPOINT=https://hkust.azure-api.net
AZURE_OPENAI_API_KEY=ä½ çš„AzureOpenAIKey

# ä½ æƒ³ç”¨çš„ API ç‰ˆæœ¬ï¼ˆæ”¯æŒä¸¤ç§å†™æ³•ï¼‰
AZURE_OPENAI_API_VERSION=azure-openai-2025-02-01-preview
# æˆ–
# AZURE_OPENAI_API_VERSION=2025-02-01-preview

# Chat æ¨¡å‹éƒ¨ç½²åï¼ˆdeployment nameï¼‰
AZURE_OPENAI_CHAT_DEPLOYMENT=gpt-4o

# ï¼ˆå¯é€‰ï¼‰å›¾ç‰‡ç”Ÿæˆéƒ¨ç½²åï¼šå¦‚æœä¸å¡«ï¼Œä¼šç”Ÿæˆå ä½å›¾
# AZURE_OPENAI_IMAGE_DEPLOYMENT=dall-e-3

### æ­¥éª¤ 4: æµ‹è¯• API è¿æ¥

```bash
# ä½¿ç”¨ uv è¿è¡Œæµ‹è¯•è„šæœ¬
uv run python test_api.py
```

å¦‚æœçœ‹åˆ° `ğŸ‰ All tests passed!`ï¼Œè¯´æ˜é…ç½®æˆåŠŸï¼

> å¦‚æœä½ è®¾ç½®äº† `AI_PROVIDER=azure`ï¼Œè¯·æ”¹ç”¨ï¼š
```bash
uv run python test_azure_api.py
```

### æ­¥éª¤ 5: å¯åŠ¨ Web ç•Œé¢

```bash
# å¯åŠ¨ Web UI
uv run gemini-picturebook
```

ç„¶ååœ¨æµè§ˆå™¨ä¸­æ‰“å¼€ï¼š**http://localhost:8080**

## ğŸ”§ æ–¹æ³•äºŒï¼šä½¿ç”¨ pipï¼ˆä¼ ç»Ÿæ–¹å¼ï¼‰

### æ­¥éª¤ 1: åˆ›å»ºè™šæ‹Ÿç¯å¢ƒ

```bash
cd /Users/laisingkuang/Downloads/gemini_picturebook_generator
python3 -m venv venv
source venv/bin/activate  # macOS/Linux
# æˆ– Windows: venv\Scripts\activate
```

### æ­¥éª¤ 2: å®‰è£…ä¾èµ–

```bash
pip install --upgrade pip
pip install -r requirements.txt
# æˆ–è€…ä»¥å¼€å‘æ¨¡å¼å®‰è£…
pip install -e .
```

### æ­¥éª¤ 3: é…ç½® API å¯†é’¥

```bash
# å¤åˆ¶ç¯å¢ƒå˜é‡æ¨¡æ¿
cp .env.template .env

# ç¼–è¾‘ .env æ–‡ä»¶ï¼Œæ·»åŠ æ‚¨çš„ API å¯†é’¥
nano .env  # æˆ–ä½¿ç”¨å…¶ä»–ç¼–è¾‘å™¨
```

### æ­¥éª¤ 4: æµ‹è¯• API è¿æ¥

```bash
python test_api.py
```

> å¦‚æœä½ è®¾ç½®äº† `AI_PROVIDER=azure`ï¼Œè¯·æ”¹ç”¨ï¼š
```bash
python test_azure_api.py
```

### æ­¥éª¤ 5: å¯åŠ¨ Web ç•Œé¢

```bash
# æ–¹å¼ 1: ä½¿ç”¨å‘½ä»¤è¡Œå·¥å…·
python -m gemini_picturebook_generator.run_ui

# æ–¹å¼ 2: ç›´æ¥è¿è¡Œ Flask UI
python flask_ui.py

# æ–¹å¼ 3: ä½¿ç”¨æ ¹ç›®å½•çš„å¯åŠ¨è„šæœ¬
python run_ui.py
```

ç„¶ååœ¨æµè§ˆå™¨ä¸­æ‰“å¼€ï¼š**http://localhost:8080**

## ğŸ§ª æµ‹è¯•æ­¥éª¤

### 1. åŸºç¡€åŠŸèƒ½æµ‹è¯•

å¯åŠ¨ Web ç•Œé¢åï¼Œå°è¯•ç”Ÿæˆä¸€ä¸ªç®€å•çš„æ•…äº‹ï¼š

1. æ‰“å¼€ http://localhost:8080
2. åœ¨"æ•…äº‹åˆ›æ„"ä¸­è¾“å…¥ï¼š`ä¸€åªå®³ç¾çš„æœºå™¨äººå­¦ä¹ ç”»ç”»`
3. åœºæ™¯æ•°é‡é€‰æ‹©ï¼š`3`ï¼ˆå¿«é€Ÿæµ‹è¯•ï¼‰
4. ç‚¹å‡»"ç”Ÿæˆæ•…äº‹"æŒ‰é’®
5. ç­‰å¾…ç”Ÿæˆå®Œæˆï¼ˆçº¦ 0.3 åˆ†é’Ÿï¼‰

### 2. æŸ¥çœ‹ç”Ÿæˆçš„æ•…äº‹

- ç”Ÿæˆå®Œæˆåï¼Œæ•…äº‹ä¼šè‡ªåŠ¨æ˜¾ç¤ºåœ¨é¡µé¢ä¸Š
- å¯ä»¥ä¸‹è½½ HTML æˆ– PDF ç‰ˆæœ¬
- è®¿é—® `/gallery` æŸ¥çœ‹æ‰€æœ‰ç”Ÿæˆçš„æ•…äº‹

### 3. æµ‹è¯•ä¸åŒåœºæ™¯æ•°é‡

å°è¯•ç”Ÿæˆä¸åŒé•¿åº¦çš„æ•…äº‹ï¼š
- **3 åœºæ™¯**ï¼šå¿«é€Ÿæµ‹è¯•ï¼ˆ~0.3 åˆ†é’Ÿï¼‰
- **6 åœºæ™¯**ï¼šæ ‡å‡†é•¿åº¦ï¼ˆ~0.6 åˆ†é’Ÿï¼‰
- **12 åœºæ™¯**ï¼šè¾ƒé•¿æ•…äº‹ï¼ˆ~1.2 åˆ†é’Ÿï¼‰
- **25 åœºæ™¯**ï¼šå²è¯—çº§æ•…äº‹ï¼ˆ~2.5 åˆ†é’Ÿï¼‰

### 4. æµ‹è¯•ä¸åŒè‰ºæœ¯é£æ ¼

åœ¨ç”Ÿæˆç•Œé¢å°è¯•ä¸åŒçš„è‰ºæœ¯é£æ ¼ï¼š
- ğŸ¨ Cartoonï¼ˆå¡é€šï¼‰
- ğŸ‡¯ğŸ‡µ Animeï¼ˆåŠ¨æ¼«ï¼‰
- ğŸ“¸ Realisticï¼ˆå†™å®ï¼‰
- ğŸ¨ Watercolorï¼ˆæ°´å½©ï¼‰
- ğŸ’» Digital Artï¼ˆæ•°å­—è‰ºæœ¯ï¼‰
- ğŸ–¼ï¸ Oil Paintingï¼ˆæ²¹ç”»ï¼‰
- âœï¸ Sketchï¼ˆç´ æï¼‰
- âš”ï¸ Fantasy Artï¼ˆå¥‡å¹»è‰ºæœ¯ï¼‰

## ğŸ› å¸¸è§é—®é¢˜æ’æŸ¥

### é—®é¢˜ 1: "API key not configured"

**è§£å†³æ–¹æ¡ˆï¼š**
1. æ£€æŸ¥ `.env` æ–‡ä»¶æ˜¯å¦å­˜åœ¨
2. ç¡®è®¤ `.env` æ–‡ä»¶ä¸­çš„ `GOOGLE_API_KEY` å·²è®¾ç½®
3. ç¡®ä¿ API å¯†é’¥æ ¼å¼æ­£ç¡®ï¼ˆæ²¡æœ‰å¤šä½™çš„ç©ºæ ¼ï¼‰

```bash
# æ£€æŸ¥ .env æ–‡ä»¶
cat .env
```

### é—®é¢˜ 2: "Connection failed" æˆ– "API test failed"

**è§£å†³æ–¹æ¡ˆï¼š**
1. éªŒè¯ API å¯†é’¥æ˜¯å¦æœ‰æ•ˆï¼šè®¿é—® https://aistudio.google.com/app/apikey
2. æ£€æŸ¥ç½‘ç»œè¿æ¥
3. ç¡®è®¤ API é…é¢æœªç”¨å®Œï¼ˆå…è´¹ç‰ˆæ¯å¤© 1,500 ä¸ªè¯·æ±‚ï¼‰

```bash
# é‡æ–°æµ‹è¯• API
python test_api.py
```

### é—®é¢˜ 3: "Module not found" é”™è¯¯

**è§£å†³æ–¹æ¡ˆï¼š**
1. ç¡®ä¿å·²å®‰è£…æ‰€æœ‰ä¾èµ–ï¼š
   ```bash
   # ä½¿ç”¨ uv
   uv sync
   
   # æˆ–ä½¿ç”¨ pip
   pip install -r requirements.txt
   ```

2. ç¡®ä¿è™šæ‹Ÿç¯å¢ƒå·²æ¿€æ´»ï¼š
   ```bash
   source venv/bin/activate  # macOS/Linux
   ```

### é—®é¢˜ 4: ç«¯å£ 8080 å·²è¢«å ç”¨

**è§£å†³æ–¹æ¡ˆï¼š**
1. æŸ¥æ‰¾å ç”¨ç«¯å£çš„è¿›ç¨‹ï¼š
   ```bash
   lsof -i :8080  # macOS/Linux
   ```

2. ä¿®æ”¹ Flask åº”ç”¨çš„ç«¯å£ï¼ˆç¼–è¾‘ `flask_ui.py` æˆ– `gemini_picturebook_generator/flask_ui.py`ï¼‰ï¼š
   ```python
   app.run(host='0.0.0.0', port=8081, debug=False)  # æ”¹ä¸ºå…¶ä»–ç«¯å£
   ```

### é—®é¢˜ 5: PDF ç”Ÿæˆå¤±è´¥

**è§£å†³æ–¹æ¡ˆï¼š**
> è¯´æ˜ï¼šPDF å¯¼å‡ºä¾èµ– WeasyPrintã€‚åœ¨ macOS ä¸Šå¦‚æœç¼ºå°‘ç³»ç»Ÿåº“ï¼ˆå¸¸è§æŠ¥é”™æ˜¯æ‰¾ä¸åˆ° `libgobject`ï¼‰ï¼Œä¼šå¯¼è‡´ PDF ç”Ÿæˆå¤±è´¥ã€‚
> **å¦‚æœä½ ä¸éœ€è¦ PDFï¼Œåªæƒ³è·‘é€š Web UI / ç”Ÿæˆå›¾ç‰‡**ï¼Œå¯ä»¥ç›´æ¥å¿½ç•¥è¿™ç±» WeasyPrint æç¤ºï¼ˆç¨‹åºä¼šè‡ªåŠ¨è·³è¿‡ PDF ç”Ÿæˆï¼‰ã€‚

1. ç¡®ä¿å·²å®‰è£… `weasyprint`ï¼š
   ```bash
   pip install weasyprint
   ```

2. åœ¨ macOS ä¸Šï¼Œå¯èƒ½éœ€è¦å®‰è£…é¢å¤–çš„ç³»ç»Ÿä¾èµ–ï¼š
   ```bash
   brew install cairo pango gdk-pixbuf libffi glib
   ```

## ğŸ“Š æˆåŠŸæŒ‡æ ‡

å¦‚æœä¸€åˆ‡æ­£å¸¸ï¼Œæ‚¨åº”è¯¥çœ‹åˆ°ï¼š

âœ… **API æµ‹è¯•é€šè¿‡**
```bash
$ python test_api.py
ğŸ” Testing Google Gemini API connection...
âœ… Client initialized successfully
ğŸ§ª Testing text generation...
âœ… Text response: API test successful
ğŸ–¼ï¸  Testing image generation...
âœ… Image generation response has X parts
ğŸ‰ All tests passed!
```

âœ… **Web ç•Œé¢æ­£å¸¸å¯åŠ¨**
```
ğŸš€ Starting Modern AI Story Generator UI v2.0
âœ¨ Features: UNLIMITED scenes, modern design, real-time progress
ğŸŒ Open your browser to: http://localhost:8080
```

âœ… **å¯ä»¥æˆåŠŸç”Ÿæˆæ•…äº‹**
- åœ¨ Web ç•Œé¢ä¸­èƒ½å¤Ÿæäº¤ç”Ÿæˆè¯·æ±‚
- çœ‹åˆ°å®æ—¶è¿›åº¦æ›´æ–°
- æ•…äº‹ç”Ÿæˆå®Œæˆåèƒ½å¤ŸæŸ¥çœ‹å’Œä¸‹è½½

## ğŸ¯ å¿«é€Ÿæµ‹è¯•å‘½ä»¤æ€»ç»“

```bash
# 1. è¿›å…¥é¡¹ç›®ç›®å½•
cd /Users/laisingkuang/Downloads/gemini_picturebook_generator

# 2. å®‰è£…ä¾èµ–ï¼ˆä½¿ç”¨ uvï¼‰
uv sync

# 3. é…ç½® API å¯†é’¥
cp .env.template .env
# ç„¶åç¼–è¾‘ .env æ–‡ä»¶æ·»åŠ æ‚¨çš„ API å¯†é’¥

# 4. æµ‹è¯• API
uv run python test_api.py

# 5. å¯åŠ¨ Web ç•Œé¢
uv run gemini-picturebook

# 6. åœ¨æµè§ˆå™¨ä¸­æ‰“å¼€
open http://localhost:8080  # macOS
```

## ğŸ“š ä¸‹ä¸€æ­¥

æˆåŠŸè¿è¡Œåï¼Œæ‚¨å¯ä»¥ï¼š

1. **ç”Ÿæˆæ‚¨çš„ç¬¬ä¸€ä¸ªæ•…äº‹**ï¼šåœ¨ Web ç•Œé¢ä¸­å°è¯•ä¸åŒçš„æ•…äº‹åˆ›æ„
2. **æµè§ˆå›¾åº“**ï¼šè®¿é—® http://localhost:8080/gallery æŸ¥çœ‹æ‰€æœ‰ç”Ÿæˆçš„æ•…äº‹
3. **è‡ªå®šä¹‰è®¾ç½®**ï¼šå°è¯•ä¸åŒçš„è‰ºæœ¯é£æ ¼ã€åœºæ™¯æ•°é‡å’Œè§’è‰²è®¾å®š
4. **é›†æˆ Claude Desktop**ï¼šå¦‚æœéœ€è¦ï¼Œå¯ä»¥é…ç½® MCP æœåŠ¡å™¨ä¸ Claude Desktop é›†æˆ

## ğŸ’¡ æç¤º

- **é¦–æ¬¡æµ‹è¯•å»ºè®®ä½¿ç”¨ 3-6 ä¸ªåœºæ™¯**ï¼Œè¿™æ ·ç”Ÿæˆé€Ÿåº¦å¿«ï¼Œä¾¿äºå¿«é€ŸéªŒè¯åŠŸèƒ½
- **API æœ‰é€Ÿç‡é™åˆ¶**ï¼šæ¯åˆ†é’Ÿ 10 ä¸ªè¯·æ±‚ï¼Œæ¯ä¸ªåœºæ™¯å¤§çº¦éœ€è¦ 6 ç§’
- **ä¿å­˜æ‚¨çš„ API å¯†é’¥**ï¼š`.env` æ–‡ä»¶å·²æ·»åŠ åˆ° `.gitignore`ï¼Œä¸ä¼šè¢«æäº¤åˆ°ç‰ˆæœ¬æ§åˆ¶
- **æŸ¥çœ‹æ—¥å¿—**ï¼šå¦‚æœé‡åˆ°é—®é¢˜ï¼ŒæŸ¥çœ‹ç»ˆç«¯è¾“å‡ºçš„é”™è¯¯ä¿¡æ¯

ç¥æ‚¨ä½¿ç”¨æ„‰å¿«ï¼ğŸ¨ğŸ“šâœ¨

